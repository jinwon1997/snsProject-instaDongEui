<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <script src="https://cdn.iamport.kr/v1/iamport.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"></script>
    <script src="https://cdn.portone.io/v2/browser-sdk.js"></script>

    <link rel="stylesheet" href="/css/home.css">
    <script src="https://kit.fontawesome.com/59843e7d25.js" crossorigin="anonymous"></script>


    <style>
        *,
        html,
        body {
            padding: 0;
            margin: 0;
        }
        #side_nav{
            position: absolute;
            left: 0;
        }
        .container {
            display: flex;
            justify-content: center;
        }

        .emo-container {
            width: 600px;
            border: 1px solid black;
            box-sizing: border-box;
            display: flex;
            justify-content: center;

        }

        .emo-thumnail {
            width: 130px;
            height: 130px;
        }

        .emo-thumnail img {
            width: 100%;
            height: 100%;;
            object-fit: cover;
        }

        .emo-content {
            display: flex;
            flex-direction: column;
            text-align: center;
        }

        .emo-name,
        .emo-price {
            text-align: center;
            width: 400px;
            margin-top: 10px;
        }

        .emoticon {
            margin-top: 10px;
            margin-left: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            width: 400px;
            font-size: 12px;
            /* Adjust the font size as needed */
        }

        .button {
            display: flex;
            justify-content: space-evenly;

        }
    </style>
</head>

<body>
<div id="side_nav">
    <div class="nav_load"></div>
</div>
<div class="container">
    <div class="emo-container">
        <div class="emo-thumnail">
            <img src="/img/img5.png" alt="">
            <div class="button">
                <input type="button" th:value="${#strings.contains(already.emoticon, '1')} ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤'"  class="buy-emo" id="purchaseButton" th:attr="disabled=${#strings.contains(already.emoticon, '1')} ? 'disabled' : null">
            </div>
        </div>
        <div class="emo-content">
            <div class="emo-name">ì¸ìŠ¤íƒ€ ì´ëª¨í‹°ì½˜</div>
            <div class="emo-price">100ì›</div>
            <div class="emoticon" id="11">
                ğŸ˜‚ ğŸ˜… ğŸ¤£ ğŸ˜¥ ğŸ˜† ğŸ˜ ğŸ˜± ğŸ˜´ ğŸ˜µ ğŸ˜· ğŸ¤¥ ğŸ˜ ğŸ¤« ğŸ¤­ âŒš â° â± âš½ âš¾
                ğŸ ğŸ€ ğŸˆ ğŸ“ â˜ âœŒ âœ‹ ğŸ‘† ğŸ‘‡ ğŸ‘ˆ ğŸ‘‰ ğŸ‘ ğŸ‘ ğŸ‘Œ ğŸ¤Ÿ ğŸŒ­ ğŸ” ğŸŒ® ğŸ•
                ğŸ ğŸ© ğŸ¥ ğŸ¥£ â˜• ğŸ¥› ğŸŒ· ğŸŒ» ğŸŒ¼ ğŸŒ½ ğŸ… ğŸ† ğŸ‡ ğŸ‰ ğŸŠ ğŸ ğŸ ğŸ’ ğŸ“
                ğŸ¥ ğŸŒ‚ ğŸ‰ ğŸ¨ ğŸ’Š ğŸ“— ğŸ“˜ ğŸ“• ğŸ”Š ğŸ¸ ğŸ¹ ğŸº ğŸ» ğŸ¤ ğŸ¦… ğŸ¦‰ ğŸµ ğŸ¶ ğŸ¹
                ğŸ¦ ğŸ‘€ ğŸ‘‚ ğŸ‘ƒ ğŸ™ ğŸ™… ğŸ™† ğŸ¤¦ ğŸ‘„ ğŸ’‹ ğŸ‘… ğŸ§¡ ğŸ’– ğŸ’˜ ğŸ’• ğŸ’ ğŸ’‘ ğŸš ğŸšŠ ğŸš‘
                ğŸš• ğŸšš ğŸš›
            </div>
        </div>
    </div>

</div>

</body>

<script>

    var IMP = window.IMP;
    var userData = null;
    IMP.init('imp80283140');

    $(document).ready(function () {
        requestUser();
    })

    function requestUser() {
        $.ajax({
            url: "/payments/getUserInfo",
            type: "POST",
            async: false,
            success: function (data) {
                console.log(data);
                userData = data;
            }
        })
    }
    $('.buy-emo').click( function () {
        console.log("í´ë¦­ë¨");
        requestPay();
    })
    function requestPay() {
        console.log('ì‹œì‘');
        IMP.request_pay(
            {
                pg: "html5_inicis",
                pay_method: "card",
                merchant_uid: "6",
                name: "ì´ëª¨ì§€íŒ©",
                amount: 100,
                buyer_email: userData.buyer_email,
                buyer_name: userData.buyer_name,
                buyer_tel: userData.buyer_tel,
                buyer_addr: "",
                buyer_postcode: "",
            },
            function (rsp) {
                if (rsp.success) {
                    // callback
                    alert("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ì œ ê³ ìœ  ID: " + rsp.imp_uid);
                    console.log("ê²°ì œê³ ìœ ë²ˆí˜¸: " + rsp.imp_uid);

                    $.ajax({
                        url: "/payments/paymentProc",
                        type: 'POST',
                        data: {
                            impUid: rsp.imp_uid,
                            emoticonId: rsp.merchant_uid
                        }, error: function (xhr) {
                            console.log(xhr);
                        }
                    }).done(function (data) {
                        console.log("ì„œë²„ë¡œë¶€í„° ìˆ˜ì‹ ë°›ì€ ê°’: " + data);
                        location.replace("/payments/");
                    })
                }
            })
    }

    // function requestPay() {
    //     IMP.request_pay(
    //         {
    //             pg: "html5_inicis",
    //             pay_method: "card",
    //             merchant_uid: "57008833-33004",
    //             name: "ë‹¹ê·¼ 10kg",
    //             amount: 1004,
    //             buyer_email: "Iamport@chai.finance",
    //             buyer_name: "í¬íŠ¸ì› ê¸°ìˆ ì§€ì›íŒ€",
    //             buyer_tel: "010-1234-5678",
    //             buyer_addr: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì‚¼ì„±ë™",
    //             buyer_postcode: "123-456",
    //         },
    //         function (rsp) {
    //             if (rsp.success) {
    //
    // }
    // // POST ìš”ì²­ì„ ë°›ëŠ” /payments/complete
    // $("form").submit(async function (event) {
    //     event.preventDefault();
    //     const PORTONE_API_KEY = "2780766266443383";
    //     const secret = "hqmungUW3ne2IVibauftMw5eNveufNoBiypcyuCcmIDwA9r2W45x2yG9I8zu0pArS7lNQQTY2FUdM3Kk";
    //
    //     try {
    //         // ìš”ì²­ì˜ bodyë¡œ SDKì˜ ì‘ë‹µ ì¤‘ txIdì™€ paymentIdê°€ ì˜¤ê¸°ë¥¼ ê¸°ëŒ€í•©ë‹ˆë‹¤.
    //         const {txId, paymentId} = $(this).serializeObject(); // jQuery serializeObject í•¨ìˆ˜ ì‚¬ìš©
    //
    //         // 1. í¬íŠ¸ì› APIë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì•¡ì„¸ìŠ¤ í† í°ì„ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.
    //         const signinResponse = await $.ajax({
    //             url: "https://api.iamport.kr/users/getToken",
    //             type: "POST",
    //             contentType: "application/json",
    //             data: JSON.stringify({
    //                 imp_key: PORTONE_API_KEY,
    //                 imp_secret: secret
    //             }),
    //         });
    //         const {access_token} = signinResponse;
    //
    //         // 2. í¬íŠ¸ì› ê²°ì œë‚´ì—­ ë‹¨ê±´ì¡°íšŒ API í˜¸ì¶œ
    //         const paymentResponse = await $.ajax({
    //             url: `https://api.iamport.kr/payments/${paymentId}`,
    //             type: "GET",
    //             headers: {
    //                 "Content-Type": "application/json",
    //                 "Authorization": "Bearer " + access_token
    //             },
    //         });
    //         const {payment: {id, transactions}} = paymentResponse;
    //         // ëŒ€í‘œ íŠ¸ëœì­ì…˜(ìŠ¹ì¸ëœ íŠ¸ëœì­ì…˜)ì„ ì„ íƒí•©ë‹ˆë‹¤.
    //         const transaction = transactions.find(tx => tx.is_primary === true);
    //
    //         // 3. ê°€ë§¹ì  ë‚´ë¶€ ì£¼ë¬¸ ë°ì´í„°ì˜ ê°€ê²©ê³¼ ì‹¤ì œ ì§€ë¶ˆëœ ê¸ˆì•¡ì„ ë¹„êµí•©ë‹ˆë‹¤.
    //         const order = await OrderService.findById(id);
    //         if (order.amount === transaction.amount.total) {
    //             switch (status) {
    //                 case "VIRTUAL_ACCOUNT_ISSUED": {
    //                     const {virtual_account} = transaction.payment_method_detail;
    //                     // ê°€ìƒ ê³„ì¢Œê°€ ë°œê¸‰ëœ ìƒíƒœì…ë‹ˆë‹¤.
    //                     // ê³„ì¢Œ ì •ë³´(virtual_account)ë¥¼ ì´ìš©í•´ ì›í•˜ëŠ” ë¡œì§ì„ êµ¬ì„±í•˜ì„¸ìš”.
    //                     break;
    //                 }
    //                 case "PAID": {
    //                     // ëª¨ë“  ê¸ˆì•¡ì„ ì§€ë¶ˆí–ˆìŠµë‹ˆë‹¤! ì™„ë£Œ ì‹œ ì›í•˜ëŠ” ë¡œì§ì„ êµ¬ì„±í•˜ì„¸ìš”.
    //                     break;
    //                 }
    //             }
    //         } else {
    //             // ê²°ì œ ê¸ˆì•¡ì´ ë¶ˆì¼ì¹˜í•˜ì—¬ ìœ„/ë³€ì¡° ì‹œë„ê°€ ì˜ì‹¬ë©ë‹ˆë‹¤.
    //         }
    //     } catch (e) {
    //         // ê²°ì œ ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
    //         // ì—ëŸ¬ ì²˜ë¦¬ ë¡œì§ ì¶”ê°€
    //         console.error(e);
    //     }
    // });


</script>
<script src="/js/home.js"></script>

</html>